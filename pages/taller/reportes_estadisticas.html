<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes y Estadísticas - Portal de Taller</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="../../style.css">
    <style>
        body { background-color: #202020; }
        .portal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 40px; background-color: #1a1a1a; border-bottom: 1px solid #333; }
        .header-left { display: flex; align-items: center; gap: 25px; }
        .portal-header .logo { width: 120px; }
        .back-link { color: #c0c0c0; text-decoration: none; font-size: 15px; display: flex; align-items: center; gap: 8px; transition: color 0.3s ease; }
        .back-link:hover { color: #f39c12; }
        .header-right { text-align: right; }
        .header-right h2 { margin: 0; font-size: 1.2em; color: #ffffff; }
        .header-right p { margin: 0; font-size: 0.9em; color: #a0a0a0; }
        
        .page-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 20px;}
        .page-title { font-size: 2.2em; color: #ffffff; margin: 0; }
        .filter-buttons { display: flex; gap: 10px; }
        .filter-btn { background-color: #3f3f3f; border: 1px solid #555; color: #f0f0f0; padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .filter-btn:hover { background-color: #555; }
        .filter-btn.active { background-color: #f39c12; color: #1a1a1a; border-color: #f39c12; }

        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background-color: #2c2c2c; padding: 25px; border-radius: 12px; }
        .kpi-card .kpi-title { font-size: 1em; color: #a0a0a0; margin: 0 0 10px 0; }
        .kpi-card .kpi-value { font-size: 2.2em; color: #ffffff; font-weight: bold; margin: 0; }

        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; align-items: flex-start; }
        .chart-container { background-color: #2c2c2c; border-radius: 12px; padding: 30px; }
        .chart-container h3 { font-size: 1.4em; color: #ffffff; margin-top: 0; margin-bottom: 35px; }

        .bar-chart { display: flex; justify-content: space-around; align-items: flex-end; height: 250px; border-left: 1px solid #555; border-bottom: 1px solid #555; padding-left: 10px; }
        .bar-wrapper { display: flex; flex-direction: column; align-items: center; gap: 8px; flex: 1; }
        .bar { background-color: #f39c12; width: 60%; max-width: 40px; border-radius: 4px 4px 0 0; transition: height 0.5s ease-out; }
        .bar-label { font-size: 0.8em; color: #a0a0a0; }

        .pie-chart-wrapper { display: flex; flex-direction: column; align-items: center; gap: 25px; }
        .pie-chart { width: 180px; height: 180px; border-radius: 50%; transition: background 0.5s ease-out; }
        .pie-legend { list-style: none; padding: 0; width: 100%; }
        .pie-legend li { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 0.9em; }
        .legend-color { width: 15px; height: 15px; border-radius: 3px; }

        @media (max-width: 900px) {
            .charts-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="portal-header">
        <div class="header-left">
            <a href="../../portal_taller.html"><img src="../../imagenes/Logo_Autoguest.png" alt="Logo de AutoGuest" class="logo"></a>
            <a href="../../portal_taller.html" class="back-link"><i class="fas fa-arrow-left"></i> Volver al Panel</a>
        </div>
        <div class="header-right">
            <h2>Mecánica Rápida S.L.</h2>
            <p>Portal de Taller</p>
        </div>
    </header>

    <main class="page-container">
        <div class="page-header">
            <h1 class="page-title">Reportes y Estadísticas</h1>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="updateDashboard('mes', this)">Este Mes</button>
                <button class="filter-btn" onclick="updateDashboard('trimestre', this)">Últimos 3 Meses</button>
                <button class="filter-btn" onclick="updateDashboard('ano', this)">Este Año</button>
            </div>
        </div>

        <section class="kpi-grid">
            <div class="kpi-card"><p class="kpi-title">Ingresos Totales</p><h3 class="kpi-value" id="kpi-ingresos"></h3></div>
            <div class="kpi-card"><p class="kpi-title">Servicios Realizados</p><h3 class="kpi-value" id="kpi-servicios"></h3></div>
            <div class="kpi-card"><p class="kpi-title">Clientes Nuevos</p><h3 class="kpi-value" id="kpi-clientes"></h3></div>
            <div class="kpi-card"><p class="kpi-title">Valoración Promedio</p><h3 class="kpi-value" id="kpi-valoracion"></h3></div>
        </section>

        <section class="charts-grid">
            <div class="chart-container">
                <h3 id="bar-chart-title"></h3>
                <div class="bar-chart" id="bar-chart"></div>
            </div>
            <div class="chart-container">
                <h3 id="pie-chart-title"></h3>
                <div class="pie-chart-wrapper">
                    <div class="pie-chart" id="pie-chart"></div>
                    <ul class="pie-legend" id="pie-legend"></ul>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- BASE DE DATOS SIMULADA ---
        const reportData = {
            mes: {
                kpis: { ingresos: "$2,500", servicios: "42", clientes: "12", valoracion: "4.8 / 5" },
                barChart: { title: "Ingresos de la Semana", labels: ["Sem 1", "Sem 2", "Sem 3", "Sem 4"], values: [40, 75, 60, 100] },
                pieChart: { title: "Servicios Populares (Mes)", labels: ["Aceite", "Frenos", "Alineación", "Otros"], values: [40, 30, 15, 15] }
            },
            trimestre: {
                kpis: { ingresos: "$8,200", servicios: "130", clientes: "35", valoracion: "4.7 / 5" },
                barChart: { title: "Ingresos del Trimestre", labels: ["Oct", "Nov", "Dic"], values: [60, 80, 100] },
                pieChart: { title: "Servicios Populares (Trim.)", labels: ["Aceite", "Frenos", "Motor", "Otros"], values: [35, 25, 25, 15] }
            },
            // ===== DATOS CORREGIDOS Y AMPLIADOS PARA "AÑO" =====
            ano: {
                kpis: { ingresos: "$35,600", servicios: "550", clientes: "150", valoracion: "4.8 / 5" },
                barChart: { 
                    title: "Ingresos Mensuales del Año", 
                    labels: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"], 
                    values: [50, 55, 65, 60, 70, 75, 70, 80, 85, 80, 90, 100] 
                },
                pieChart: { 
                    title: "Servicios Populares (Año)",
                    labels: ["Mantenimiento", "Reparación", "Diagnóstico", "Otros"], 
                    values: [50, 25, 15, 10] 
                }
            }
        };

        const pieColors = ["#f39c12", "#3498db", "#2ecc71", "#95a5a6"];

        // --- FUNCIÓN PRINCIPAL PARA ACTUALIZAR EL DASHBOARD ---
        function updateDashboard(periodo, button) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            const data = reportData[periodo];

            document.getElementById('kpi-ingresos').textContent = data.kpis.ingresos;
            document.getElementById('kpi-servicios').textContent = data.kpis.servicios;
            document.getElementById('kpi-clientes').textContent = data.kpis.clientes;
            document.getElementById('kpi-valoracion').textContent = data.kpis.valoracion;

            const barChartContainer = document.getElementById('bar-chart');
            document.getElementById('bar-chart-title').textContent = data.barChart.title;
            barChartContainer.innerHTML = '';
            data.barChart.labels.forEach((label, index) => {
                const value = data.barChart.values[index];
                barChartContainer.innerHTML += `<div class="bar-wrapper"><div class="bar" style="height: ${value}%;"></div><span class="bar-label">${label}</span></div>`;
            });

            const pieChart = document.getElementById('pie-chart');
            const pieLegend = document.getElementById('pie-legend');
            document.getElementById('pie-chart-title').textContent = data.pieChart.title;
            let gradientString = 'conic-gradient(';
            let legendHTML = '';
            let cumulativePercent = 0;

            data.pieChart.labels.forEach((label, index) => {
                const value = data.pieChart.values[index];
                const color = pieColors[index];
                gradientString += `${color} ${cumulativePercent}% ${cumulativePercent + value}%, `;
                legendHTML += `<li><span class="legend-color" style="background-color: ${color};"></span> ${label} (${value}%)</li>`;
                cumulativePercent += value;
            });
            gradientString = gradientString.slice(0, -2) + ')';

            pieChart.style.background = gradientString;
            pieLegend.innerHTML = legendHTML;
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard('mes', document.querySelector('.filter-btn.active'));
        });
    </script>
</body>
</html>